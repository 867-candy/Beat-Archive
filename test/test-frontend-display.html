<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スコア差分表示テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
        }
        .test-case {
            background-color: #34495e;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .song-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .score-display {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>A.S.D.F [EX] スコア差分表示テスト</h1>
    
    <div class="test-case">
        <div class="song-title">A.S.D.F [EX]</div>
        <div class="score-display">
            <strong>8/3までのベスト:</strong> 2012
        </div>
        <div class="score-display">
            <strong>8/4のスコア:</strong> 2052
        </div>
        <div class="score-display">
            <strong>差分:</strong> +40
        </div>
        <div class="score-display">
            <strong>フロントエンド表示:</strong> <span id="score-result"></span>
        </div>
    </div>
    
    <div class="test-case">
        <div class="song-title">Test Song [HARD]</div>
        <div class="score-display">
            <strong>8/3までのベスト:</strong> 3250
        </div>
        <div class="score-display">
            <strong>8/4のスコア:</strong> 3280
        </div>
        <div class="score-display">
            <strong>差分:</strong> +30
        </div>
        <div class="score-display">
            <strong>フロントエンド表示:</strong> <span id="score-result2"></span>
        </div>
    </div>

    <script>
        // renderer.jsのformatScoreDiff関数を再現
        function formatScoreDiff(updates, currentScore) {
            const scoreUpdate = updates.find(u => u.type === 'score');
            const dailyScoreUpdate = updates.find(u => u.type === 'daily_score');
            const firstPlayUpdate = updates.find(u => u.type === 'daily_first_play');

            if (scoreUpdate) {
                // scorelogからのスコア更新
                const diff = scoreUpdate.new - scoreUpdate.old;
                if (diff > 0) {
                    return `${currentScore} <span style="color: #27ae60;">+${diff}</span>`;
                }
            }

            // 前日差分スコア改善がある場合
            if (dailyScoreUpdate) {
                return `${currentScore} <span style="color: #9b59b6; font-weight: bold;">+${dailyScoreUpdate.improvement}</span>`;
            }

            // 初回プレイの場合 - 差分表示なしでそのまま表示
            if (firstPlayUpdate) {
                return `${currentScore}`;
            }

            return currentScore;
        }

        // A.S.D.F [EX]のテストケース
        const testCase1 = {
            updates: [
                {
                    type: 'daily_score',
                    old: 2012,
                    new: 2052,
                    improvement: 40
                }
            ],
            currentScore: 2052
        };

        // Test Song [HARD]のテストケース
        const testCase2 = {
            updates: [
                {
                    type: 'daily_score',
                    old: 3250,
                    new: 3280,
                    improvement: 30
                }
            ],
            currentScore: 3280
        };

        // 結果を表示
        document.getElementById('score-result').innerHTML = formatScoreDiff(testCase1.updates, testCase1.currentScore);
        document.getElementById('score-result2').innerHTML = formatScoreDiff(testCase2.updates, testCase2.currentScore);

        console.log('A.S.D.F [EX] テスト結果:', formatScoreDiff(testCase1.updates, testCase1.currentScore));
        console.log('Test Song [HARD] テスト結果:', formatScoreDiff(testCase2.updates, testCase2.currentScore));
    </script>
</body>
</html>
